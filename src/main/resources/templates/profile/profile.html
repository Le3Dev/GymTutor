<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

  <body>

    <h1>Meu Perfil</h1>

    <!-- Mensagens de erro e sucesso -->
    <div th:if="${successMessage}" style="color: green;">
      <p th:text="${successMessage}"></p>
    </div>
    <div th:if="${errorMessage}" style="color: red;">
      <p th:text="${errorMessage}"></p>
    </div>

    <!-- Informações do usuário -->
    <h2 th:text="'Nome: ' + ${user.userName}"></h2>
    <p th:text="'Email: ' + ${user.userEmail}"></p>
    <p th:text="'CPF: ' + ${user.userCpf}"></p>

    <!-- Exibir roles -->
    <h3 th:text="'Papel do usuário: ' + ${user.role.roleName.displayName}"></h3>

    <!-- Se o usuário já tem CREEF e não for Administrador -->
    <div th:if="${personal != null}">
        <p th:text="'CREEF: ' + ${personal.personalCREEF}"></p>
    </div>

    <!-- Se o usuário ainda NÃO tem CREEF -->
    <div th:if="${personal == null and user.role.roleName.displayName == 'Aluno'}">
      <button onclick="openCreefModal()">Cadastrar CREEF</button>
    </div>


  <div class="actions-cell">

    <form th:action="@{/profile/change-password}" th:method="get" style="display: inline;">
      <button type="submit">Alterar Senha</button>
    </form>


    <form id="disableForm" th:action="@{/profile/disable-account}" th:method="post" style="display: inline;">
      <input type="hidden" name="confirmPassword" id="confirmPassword">
      <button type="button" onclick="confirmDisable()">Desativar Conta</button>
    </form>

  </div>


  <!-- Modal -->
  <div id="creefModal" style="display: none; position: fixed; top: 20%; left: 50%; transform: translateX(-50%);
                           background: #fff; padding: 20px; border: 1px solid #ccc; z-index: 1000;">
    <h3>Insira seu CREEF</h3>
    <form id="creefForm" th:action="@{/profile/save-creef}" method="post">
      <input type="text" name="personalCREEF" placeholder="Digite seu CREEF" required />
      <br><br>
      <button type="submit">Salvar</button>
      <button type="button" onclick="closeCreefModal()">Cancelar</button>
    </form>
  </div>

  <!-- Overlay para escurecer o fundo -->
  <div id="creefOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%;
                             height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 999;" onclick="closeCreefModal()"></div>


    <!-- Script do Modal -->
  <script>
    function openCreefModal() {
      document.getElementById("creefModal").style.display = "block";
      document.getElementById("creefOverlay").style.display = "block";
    }

    function closeCreefModal() {
      document.getElementById("creefModal").style.display = "none";
      document.getElementById("creefOverlay").style.display = "none";
    }
  </script>

    <!-- Script da desativação de conta -->
  <script>
    function confirmDisable() {
      const senha = prompt("Por favor, digite sua senha para confirmar:");

      if (senha !== null && senha.trim() !== "") {
        document.getElementById("confirmPassword").value = senha;
        if (confirm("Você tem certeza de que deseja desativar sua conta?")) {
          document.getElementById("disableForm").submit();
        }
      } else {
        alert("A senha é obrigatória para desativar a conta.");
      }
    }
  </script>

  </body>

</html>