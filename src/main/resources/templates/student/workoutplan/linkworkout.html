<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Vincular Treinos</title>
</head>
<body>

<h1>Vincular Treinos à Ficha: <span th:text="${workoutPlan.workoutPlanName}"></span></h1>

<a th:href="@{/student/workoutplan}">Voltar</a><br><br>

<!-- Mensagens -->
<div th:if="${successMessage}" style="color: green;">
    <p th:text="${successMessage}"></p>
</div>
<div th:if="${errorMessage}" style="color: red;">
    <p th:text="${errorMessage}"></p>
</div>

<!-- Treinos já vinculados -->
<h2>Treinos já vinculados</h2>
<div th:if="${#lists.isEmpty(linkedWorkoutIds)}">
    <p>Nenhum treino vinculado ainda.</p>
</div>

<div th:if="${!#lists.isEmpty(linkedWorkoutIds)}">
    <table>
        <thead>
        <tr>
            <th>Nome do Treino</th>
            <th>Tempo de Descanso</th>
            <th>Ações</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="workout : ${linkedWorkouts}">
            <td th:text="${workout.workoutName}"></td>
            <td th:text="${workout.restTime}"></td>
            <td>
                <form th:action="@{'/student/workoutplan/' + ${workoutPlan.workoutPlanId} + '/linkworkout/unlink'}" method="post">
                    <input type="hidden" name="workoutId" th:value="${workout.workoutId}" />
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit">Desvincular</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<br><br>

<!-- Botão para abrir o modal -->
<button onclick="openModal()">Vincular um novo treino</button><br><br>

<!-- Modal para vincular novo treino -->
<div id="workoutModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Vincular Novo Treino</h2>
        <p>Selecione um treino para vincular à ficha.</p>

        <label for="searchBar">Pesquisar Treinos:</label>
        <input type="text" id="searchBar" onkeyup="filterWorkouts()" placeholder="Digite o nome do treino..."><br><br>

        <div class="scrollable-table-big">
            <table>
                <thead>
                <tr>
                    <th>Nome</th>
                    <th>Tempo de Descanso</th>
                    <th>Ação</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="workout : ${workouts}" class="workout-row"
                    th:if="${!linkedWorkoutIds.contains(workout.workoutId)}"
                    th:attr="data-workout-id=${workout.workoutId}">
                    <form th:action="@{'/student/workoutplan/' + ${workoutPlan.workoutPlanId} + '/linkworkout/link'}" method="post">
                        <td th:text="${workout.workoutName}" class="workout-name"></td>
                        <td th:text="${workout.restTime}"></td>
                        <td>
                            <input type="hidden" name="workoutId" th:value="${workout.workoutId}" />
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <button type="submit">Vincular</button>
                        </td>
                    </form>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Scripts -->
<script>
    function filterWorkouts() {
        let input = document.getElementById("searchBar");
        let filter = input.value.toLowerCase();
        const rows = document.querySelectorAll(".workout-row");
        for (let i = 0; i < rows.length; i++) {
            let name = rows[i].getElementsByClassName("workout-name")[0].innerText.toLowerCase();
            rows[i].style.display = name.includes(filter) ? "" : "none";
        }
    }

    function openModal() {
        document.getElementById("workoutModal").style.display = "block";
    }

    function closeModal() {
        document.getElementById("workoutModal").style.display = "none";
    }

    window.onclick = function(event) {
        const modal = document.getElementById("workoutModal");
        if (event.target === modal) {
            modal.style.display = "none";
        }
    }
</script>

</body>
</html>